@model Hospital_Management.Models.MainModel

@{
    ViewBag.Title = "OPD Main";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<script src="~/select2/dist/js/select2.min.js" type="text/javascript"></script>
<link href="~/select2/dist/css/select2.min.css" rel="stylesheet" />

<div class="card card-custom gutter-b example example-compact">

   
    <div class="alert font-size-h3 text-center" style="background-color:#2ac9bb; color:white; font-family: Georgia, serif">
        OPD
    </div>


    <div class="card-body">
        @using (Html.BeginForm("SaveOPD", "Hospital", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", @id = "form_sample_2" }))
        {
            <input type="hidden" id="Id" name="Id" value="@Model.Pathology_OPD_Main_Details.MainId" />

            <input type="hidden" id="TotaalAmount" name="TotaalAmount" value="@ViewBag.TotaalAmount" />
            <input type="hidden" id="TotaalDiscount" name="TotaalDiscount" value="@ViewBag.TotaalDiscount " />
            <input type="hidden" id="NetAmouunt" name="NetAmouunt" value="@ViewBag.NetAmouunt" />
            <input type="hidden" id="TotaalNetPaid" name="TotaalNetPaid" value="@ViewBag.TotaalNetPaid" />
            <input type="hidden" id="NetFinalAmount" name="NetFinalAmount" value="@ViewBag.NetFinalAmount" />


            <div class="form-group row">
                <div class="col-lg-3">
                    <label>
                        Patient Name<span style="color:red;">*</span>:  &nbsp;&nbsp;&nbsp;&nbsp;  <a href="../Hospital/Patient?Id=00000000-0000-0000-0000-000000000000" style="background-color:#2ac9bb; color:white; font-size:13px;
text-decoration: underline overline; font-family: Georgia, serif" target="_blank">New Patient</a>
                    </label>
                    <div class="input-group">
                        @*<div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-user"></i></span></div>*@
                        @Html.DropDownList("drpplist", (SelectList)ViewBag.plist, "Select Patient", new { @id = "drpplist", @name = "drpplist", @class = "form-control", @required = "required" })

                    </div>
                </div>
                <div class="col-lg-3">
                    <label>Age <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-chart-bar"></i></span></div>
                        <input type="text" readonly placeholder="Age" class="form-control" id="age" name="age" value="@ViewBag.Age" required />
                    </div>
                </div>
                <div class="col-lg-3">
                    <label>Sex <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-users"></i></span></div>
                        <input type="text" readonly placeholder="Sex" class="form-control" id="sex" name="sex" value="@ViewBag.Sex" required />
                    </div>
                </div>
                <div class="col-lg-3">
                    <label>Address <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-location-arrow"></i></span></div>
                        <input type="text" readonly placeholder="Address" class="form-control" id="address" name="address" value="@ViewBag.Address" required />
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-lg-3">
                    <label>Doctor Name<span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-user-plus"></i></span></div>
                        @Html.DropDownList("drpdlist", (SelectList)ViewBag.dlist, "Select Doctor", new { @class = "form-control", @required = "required" })
                    </div>
                </div>
                <div class="col-lg-3">
                    <label>Payment Option<span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-ruble-sign"></i></span></div>
                        @Html.DropDownList("drppayment", (SelectList)ViewBag.paymentmode, "Select Payment Option", new { @class = "form-control", @required = "required" })
                    </div>
                </div>

                <div class="col-lg-3">
                    <label>Payment Status<span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-chart-line"></i></span></div>
                        @Html.DropDownList("drppstatus", (SelectList)ViewBag.paymentstatus, "Payment Status", new { @class = "form-control", @required = "required" })
                    </div>
                </div>
                <div class="col-lg-3">
                    <label> Remarks <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-pencil-alt"></i></span></div>
                        <input type="text" placeholder="Remarks" class="form-control" id="Remarks" name="Remarks" value="@Model.Pathology_OPD_Main_Details.Remarks" required />
                    </div>
                </div>
            </div>

            <div class="form-group row" hidden>
                <div class="col-lg-3">
                    <label> Total Amount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Total Amount" class="form-control" id="Total_amount" name="Total_amount" value="@Model.Pathology_OPD_Main_Details.Total_amount" required readonly />
                    </div>
                </div>
                <div class="col-lg-3">
                    <label> Discount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Total Discount" class="form-control" id="Total_deduction" name="Total_deduction" value="@Model.Pathology_OPD_Main_Details.Total_deduction" readonly required />
                    </div>
                </div>
                <div class="col-lg-3">
                    <label> Net Amount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Final Amount" class="form-control" id="Gross_total_amount" name="Gross_total_amount" readonly value="@Model.Pathology_OPD_Main_Details.Gross_total_amount" required />
                    </div>
                </div>
                <div class="col-lg-3">
                    <label> Paid Amount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Net Paid Payment" class="form-control" id="Net_Paid_amount" name="Net_Paid_amount" readonly value="@ViewBag.PaidAmount" required />
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-lg-3" id="div_amt" hidden>
                    <label> Final Amount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Final Payment" class="form-control" id="Net_total_amount" name="Net_total_amount" readonly value="@Model.Pathology_OPD_Main_Details.Net_total_amount" required />
                    </div>
                </div>



                <div class="col-lg-3">
                    <label> Additional Discount <span style="color:red;">*</span>:</label>
                    <div class="input-group">
                        <div class="input-group-prepend"><span class="input-group-text"><i class="fa fa-rupee-sign"></i></span></div>
                        <input type="number" placeholder="Additional Discount" class="form-control" id="Additonal_discount" name="Additonal_discount"
                               onchange="AdditionalDiscount()" value="@Model.Pathology_OPD_Main_Details.Additonal_discount" required />
                    </div>
                </div>

            </div>


            <div class="form-group row">
                <div id="Road" class="col-lg-12">

                    <div class="input-group">
                        <p>&nbsp;</p>
                    </div>
                    <div style=" height: 200px; overflow-y: scroll;">
                        <div id="DataDivRoad" class="col-lg-12">
                            @{Html.RenderPartial("~/Views/HospitalPartial/_GetServiceList.cshtml", @Model);}
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-body">


                @*@{Html.RenderPartial("~/Views/HospitalPartial/_servicetype_opd.cshtml", @Model);}*@
            </div>




            <div class="card-footer">
                <div class="row">
                    <div class="col-lg-5"></div>
                    <div class="col-lg-7">
                        <button type="submit" class="btn" style="background-color:#2ac9bb; color:white; width:200px"> <span class="fa fa-save"></span> @ViewBag.buttontitle</button>
                        &nbsp;&nbsp;
                        <a href="/Hospital/OPD" class="btn btn-danger"><span class="fa fa-times"></span> Cancel</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>


<script>
    $('#table_pend').dataTable({
        "bPaginate": false,
        
        "paging": false,
        "ordering": false,
        "info": false
    });
</script>


@*<script>
    var TotaalAmount = parseFloat($("#TotaalAmount").val());
    var TotaalDiscount = parseFloat($("#TotaalDiscount").val());
    var NetAmouunt = parseFloat($("#NetAmouunt").val());
    var NetFinalAmount = parseFloat($("#NetFinalAmount").val());
    var TotaalNetPaid = parseFloat($("#TotaalNetPaid").val());
    function InsertUnit(Qid, Price, Discount) {

        var Unit = $('#unit_' + Qid).val();
  
        var PriceAmt = parseFloat(Price);
        var DiscountAmt = parseFloat(Discount);
       
        TotaalAmount += (PriceAmt * Unit);
        $('#unitValue_' + Qid).val(Unit);
        TotaalDiscount += (DiscountAmt * Unit);

       
        $("#Total_amount").val(TotaalAmount);
        $("#Total_deduction").val(TotaalDiscount);
        NetAmouunt = parseFloat(TotaalAmount) - parseFloat(TotaalDiscount);
        $("#Gross_total_amount").val(NetAmouunt); 
        $("#Net_total_amount").val(NetAmouunt); 
        
    }

    function InsertPAmount(Qid) {

        var PAmt = $('#amt_' + Qid).val();

        $('#amtValue_' + Qid).val(PAmt);
        TotaalNetPaid += parseFloat(PAmt);
        $("#Net_Paid_amount").val(TotaalNetPaid);
    }

    function AdditionalDiscount() {

        var AddIDiscount = $("#Additonal_discount" ).val();
        $("#Net_total_amount").val(parseFloat($("#Gross_total_amount").val()) - parseFloat(AddIDiscount));
       

       
    }
    
</script>



<script>
    function selectallapp() {

        var checkboxes = document.getElementsByTagName('input'), val = null;

        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].type == 'checkbox') {
                if (val === null) val = checkboxes[i].checked;
                checkboxes[i].checked = val;
                totalIt();
            }
        }
    }
</script>


<script>
    function selectallapp() {

        var checkboxes = document.getElementsByTagName('input'), val = null;

        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].type == 'checkbox') {
                if (val === null) val = checkboxes[i].checked;
                checkboxes[i].checked = val;
                totalIt();
            }
        }
    }
</script>*@









<script type="text/javascript">
    function checkNum() {
        if ((event.keyCode > 64 && event.keyCode < 91) || (event.keyCode > 96 && event.keyCode < 123) || event.keyCode == 8 || event.keyCode == 32)
            return true;
        else {
            alert("Please enter only char");
            return false;
        }
    }
</script>


<script type="text/javascript">
    $('#drpplist').change(function () {
        var Id = $('#drpplist').val();
        if (Id != "") {
            $.ajax({
                url: '/Hospital/GetPatientDetail',
                dataType: "json",
                type: "POST",
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ Id: Id }),
                async: true,
                processData: false,
                cache: false,
                success: FillSubDistrict,
                error: function (xhr) {
                }
            });
        }
    });

    function FillSubDistrict(result) {
         
        var items = result.SubDistrictList;
        for (i = 0; i < items.length; i++) {
             
            $('#age').val(items[0].Age)
            $('#sex').val(items[0].Sex)
            $('#address').val(items[0].Address)
        }
    }
</script>

<script type="text/javascript">


    $("#drpplist").select2({
        templateResult: formatState
    });
    function formatState(state) {
        if (!state.id) {
            //  alert(state.id);
            return state.text;
        }
        var $state = $(
            '<span> ' + state.text + '</span>'
        );
        return $state;
    }
</script>